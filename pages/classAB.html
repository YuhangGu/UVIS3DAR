<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>3D Flow Map</title>
    <!-- D3 -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <!-- Tween -->
</head>

<body>
    <div id="map"></div>
    <script type="text/javascript">
    var width = 800,
        height = 600;

    var svg = d3.select("#map").append('svg')
        .attr("width", width).attr('height', height);


    var x = d3.scaleLinear()
                .domain([0,2])
                .range([100, width -100])


    d3.json("data.json").then(function(data) {



        data.forEach(function(sub, i) {


            var y = d3.scaleLinear()
                .domain(d3.extent(sub.arr))
                .range([height - 30, 30])

            svg.append("g")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("fill", "none")
                .selectAll("circle")
                .data(sub.arr)
                .join("circle")
                .attr("cx", x(i))
                .attr("cy", d => y(d))
                .attr("r", 2);

            svg.append("g")
                .attr("font-family", "sans-serif")
                .attr("font-size", 10)
                .selectAll("text")
                .data(sub.arr)
                .join("text")
                .attr("x", x(i)+ 10)
                .attr("y", d => y(d))
                .text(d => d);


            var gT = svg.append("g")
                .attr("font-family", "sans-serif")
                .attr("font-size", 15)
                .attr('text-anchor', "middle");


            gT.append('text')
                .attr("x", x(i))
                .attr("y", y.range()[0] + 20)
                .text(sub.name);


            var extent = d3.extent(sub.arr);

            var dist = extent[1] - extent[0];

            console.log(extent);

            var classA = [0, extent[0]+ dist/3, extent[0]+ 2*dist/3, extent[0]+ dist];
           

            var classB = [0, d3.quantile(sub.arr, 1/3), d3.quantile(sub.arr, 2/3), d3.quantile(sub.arr, 1)]

             console.log(classA, classB);



            svg.append("g")
                .attr("stroke", "red")
                .attr("stroke-width", 1.5)
                .attr("fill", "none")
                .selectAll("circle")
                .data(classA)
                .join("circle")
                .attr("cx", x(i) - 20)
                .attr("cy", d => y(d))
                .attr("r", 3);

             svg.append("g")
                .attr("font-family", "sans-serif")
                .attr("font-size", 10)
                .selectAll("text")
                .data(classA)
                .join("text")
                .attr('fill',"red")
                .attr('text-anchor', "end")
                .attr("x", x(i) - 30)
                .attr("y", d => y(d))
                .text(function(d,i){
                    if(i == 0) return null;
                    return "class" + i + ": "+ parseInt(d)
                });

            var lineA = line = d3.line()
                    .x(function(d) { return x(i) - 20 })
                    .y(function(d) { return y(d) })
                    .curve(d3.curveMonotoneX);


            svg.append("path")
                .datum(classA)  
                .attr("class", "line") 
                .attr("d", lineA)
                .attr("stroke", 'red')
                .attr("stroke-width", 1); 


            svg.append("g")
                .attr("stroke", "green")
                .attr("stroke-width", 1.5)
                .attr("fill", "none")
                .selectAll("circle")
                .data(classB)
                .join("circle")
                .attr("cx", x(i) + 40)
                .attr("cy", d => y(d))
                .attr("r", 3);

            svg.append("g")
                .attr("font-family", "sans-serif")
                .attr("font-size", 10)
                .selectAll("text")
                .data(classB)
                .join("text")
                .attr('fill',"green")
                .attr('text-anchor', "start")
                .attr("x", x(i) + 50)
                .attr("y", d => y(d))
                .text(function(d,i){
                    if(i == 0) return null;
                    return "class" + i + ": "+ parseInt(d)
                });


                  var lineB = line = d3.line()
                    .x(function(d) { return x(i) + 40 })
                    .y(function(d) { return y(d) })
                    .curve(d3.curveMonotoneX);


            svg.append("path")
                .datum(classB)  
                .attr("class", "line") 
                .attr("d", lineB)
                .attr("stroke", 'green')
                .attr("stroke-width", 1); 




        });

    });
    </script>
</body>

</html>